<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Tienda</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>
</head>
<body>
    <nav class="navbar is-transparent">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://bulma.io">
                <img src="https://bulma.io/images/bulma-logo.png" alt="Bulma: a modern CSS framework based on Flexbox" width="112" height="28">
            </a>
            <div class="navbar-burger burger" data-target="navbarExampleTransparentExample">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        <div id="navbarExampleTransparentExample" class="navbar-menu">
            <div class="navbar-start">
                <a id="navCate" class="navbar-item" href="./categoria.html">
                    CATEGORIAS
                </a>
                <a id="navMarc" class="navbar-item" href="./marca.html">
                    MARCAS
                </a>
                <a id="navProd" class="navbar-item" href="./producto.html">
                    PRODUCTOS
                </a>
            </div>
        </div>
    </nav>
    <div id ="divCat" v-if="catSeen">
        <h1>CREA CATEGORIAS</h1>
        <form id="formCreaCategoria">
            <fieldset>
                <div>
                    <label>Nombre</label>
                    <input class="input is-rounded" type="text" name="nombre"/>
                </div>
                <div>
                    <label>Descripcion</label>
                    <input class="input is-rounded" type="text" name="descripcion"/>
                </div>
                <div class="columns">
                    <div class="column">
                    </div>
                    <div class="column">
                        <input class="button is-primary" id="btnCreaCategoria" type="button" value="Crear nueva categoria"/>
                    </div>
                    <div class="column">
                    </div>
                </div>
            </fieldset>
        </form>
        <div id="divResCat" class="message is-success" v-if="resCatSeen">
            <div class="message-header">
                <p>Categoria Creada</p>
                <button id="btnCerRes" onclick="cloThiDiv()" class="delete" aria-label="delete"></button>
            </div>
            <div class="message-body">
                <div>Nombre: {{nombre}}</div>
                <div>Descripcion: {{descripcion}} </div>
            </div>
        </div>
        <div>
            <h1>OBTIENE CATEGORIAS</h1>
            <button id="btnObtenCategoria">Obtener Categorias</button>
            <div v-if="tabCatSeen">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Descripcion</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="categoria in categorias">
                          <td>Categoria : {{categoria.nombre}}</td>
                          <td>Categoria : {{categoria.descripcion}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div v-if="errCatSeen">
            <fieldset >
                <legend>ERROR</legend>
                <div>Error:  {{error}}</div>
            </fieldset>
        </div>
        <button class="button is-danger" v-on:click="showBorCatSeen">BORRA ALGUNA CATEGORIA</button>
        <div v-if="borCatSeen">
            <h1>BORRA CATEGORIAS</h1>
            <form id="formBorraCategoria">
                <fieldset>
                    <div class="field">
                        <div class="control has-icons-left">
                            <div class="select">
                                <select>
                                    <option selected>Country</option>
                                    <option>Select dropdown</option>
                                    <option>With options</option>
                                </select>
                            </div>
                            <div class="icon is-small is-left">
                                <i class="fas fa-globe"></i>
                            </div>
                        </div>
                    </div>
                    <div>
                        <input id="btnBorraCategoria" type="button" value="Borrar Categoria"/>
                    </div>
                </fieldset>
            </form>
        </div>

        <div v-if="borrResCatSeen">
            <fieldset >
                <legend>RESPUESTA</legend>
                <h2>Categoria Borrada</h2>
                <div>Mensaje: {{mensaje}}</div>
            </fieldset>
        </div>
    </div>
    <script src="../js/jquery/jquery-3.3.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script>
            // Check for click events on the navbar burger icon
            $(".navbar-burger").click(function() {
            // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
            $(".navbar-burger").toggleClass("is-active");
            $(".navbar-menu").toggleClass("is-active");
        });
        var divCat = new Vue({
            el: '#divCat',
            data:{
                catSeen: true,
                resCatSeen: false,
                errCatSeen: false,
                tabCatSeen: false,
                borCatSeen: false,
                borrResCatSeen:true,
                nombre: '',
                descripcion: '',
                error:'',
                categorias:[],
                mensaje: ''
            },
            methods:{
                showBorCatSeen: ()=>{
                    divCat.borCatSeen=!divCat.borCatSeen;
                }
            }
        });
        function cloThiDiv(){
            console.log("cerrado");
            $("#divResCat").hide();
        };
        $("#btnCreaCategoria").click(()=>{
                divCat.resCatSeen = false;
                divCat.errCatSeen = false;
                divCat.tabCatSeen = false;
                divCat.catSeen = true;
                let data = $("#formCreaCategoria").serialize();
                $.post("/categorias",data)
                    .done((res)=>{
                        divCat.nombre= res.categoria.nombre;
                        divCat.descripcion= res.categoria.descripcion;
                        divCat.resCatSeen = true;
                        divCat.catSeen = true;
                    })
                    .fail((err)=>{
                        divCat.error='Ah ocurrido un error';
                        divCat.errCatSeen = true;
                        divCat.catSeen = true;
                    });
        });
        $("#btnObtenCategoria").click(()=>{
            divCat.tabCatSeen = false;
            divCat.resCatSeen = false;
            divCat.errCatSeen = false;
            $.ajax({
                type: 'get',
                url: '/categorias',
                beforeSend: ()=>{
                    console.log('Procesando solicitud')
                },
                success: (res)=>{
                    console.log(res.categorias);
                    divCat.categorias = res.categorias;
                    divCat.tabCatSeen =true;
                },
                error: (err)=>{
                    divCat.error='Ah ocurrido un error';
                    divCat.errCatSeen = true;
                }
            });
        });
        $("#btnBorraCategoria").click(()=>{
            tablaCategorias.mostrar = false;
            divErrCat.seen = false;
            divResCat.seen = false;
            divResCatBorr.seen = false;
            let request = $.ajax({
            url: "/categorias",
            method: "DELETE",
            data: { nombre : nombre },
            dataType: "json"
            });
            console.log(request);
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Tienda</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>
</head>
<body onload="loadPage()">
    <nav class="navbar is-transparent">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://bulma.io">
                <img src="https://bulma.io/images/bulma-logo.png" alt="Bulma: a modern CSS framework based on Flexbox" width="112" height="28">
            </a>
            <div class="navbar-burger burger" data-target="navbarExampleTransparentExample">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        <div id="navbarExampleTransparentExample" class="navbar-menu">
            <div class="navbar-start">
                <a id="navCate" class="navbar-item" href="./categoria.html">
                    CATEGORIAS
                </a>
                <a id="navMarc" class="navbar-item" href="./marca.html">
                    MARCAS
                </a>
                <a id="navProd" class="navbar-item" href="./producto.html">
                    PRODUCTOS
                </a>
            </div>
        </div>
    </nav>
    <div id ="divMar" v-if="marSeen">
        <h1>CREA MARCAS</h1>
        <form id="formCreaMarca">
            <fieldset>
                <div>
                    <label>Nombre</label>
                    <input class="input is-rounded" type="text" name="nombre"/>
                </div>
                <div>
                    <label>Descripcion</label>
                    <input class="input is-rounded" type="text" name="descripcion"/>
                </div>
                <div class="columns">
                    <div class="column">
                    </div>
                    <div class="column">
                        <input class="button is-primary" id="btnCreaMarca" type="button" value="Crear nueva marca" />
                    </div>
                    <div class="column">
                    </div>
                </div>
            </fieldset>
        </form>
        <div id="divMarRes" class="message is-success" v-if="resMarSeen">
            <div class="message-header">
                <p>Marca Creada</p>
                <button onclick="cloThiDiv()" class="delete" aria-label="delete"></button>
            </div>
            <div class="message-body">
                <div>Nombre: {{nombre}}</div>
                <div>Descripcion: {{descripcion}} </div>
            </div>
        </div>
        <h1>OBTIENE MARCAS</h1>
        <button id="btnObtenMarca">Obtener Marcas</button>
        <div v-if="tabMarSeen">
            <table class="table">
                <thead>
                    <tr>
                        <th><abbr title="Position">Nombre</abbr></th>
                        <th>Descripcion</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="marca in marcas">
                      <td>{{marca.nombre}}</td>
                      <td>{{marca.descripcion}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div v-if="errMarSeen">
            <fieldset >
                <legend>ERROR</legend>
                <div>Error:  {{error}}</div>
            </fieldset>
        </div>
        <h1>BORRA CATEGORIAS</h1>
        <form id="formBorraMarca">
            <fieldset>
                <div>
                    <label>Nombre</label>
                    <input type="text" name="nombre"/>
                </div>
                <div>
                    <input id="btnBorraMarca" type="button" value="Borrar Marca"/>
                </div>
            </fieldset>
        </form>
        <div v-if="errMarSeen">
            <fieldset >
                <legend>RESPUESTA</legend>
                <h2>Marca Borrada</h2>
                <div>Mensaje: {{mensaje}}</div>
            </fieldset>
        </div>
    </div>
    <script src="../js/jquery/jquery-3.3.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script>
            // Check for click events on the navbar burger icon
            $(".navbar-burger").click(function() {
            // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
            $(".navbar-burger").toggleClass("is-active");
            $(".navbar-menu").toggleClass("is-active");
        });
        var divMar = new Vue({
            el: '#divMar',
            data:{
                marSeen: true,
                resMarSeen: false,
                errMarSeen: false,
                tabMarSeen: false,
                borMarSeen: false,
                nombre: '',
                descripcion: '',
                error:'',
                marcas:[],
                mensaje: ''
            }
        });
        function cloThiDiv(){
            console.log("cerrado");
            $("#divMarRes").hide();
        };
        $("#btnCreaMarca").click(()=>{
                divMar.resMarSeen = false;
                divMar.errMarSeen = false;
                divMar.tabMarSeen = false;
                divMar.marSeen = true;
                let data = $("#formCreaMarca").serialize();
                $.post("/marcas",data)
                    .done((res)=>{
                        divMar.nombre= res.marca.nombre;
                        divMar.descripcion= res.marca.descripcion;
                        divMar.resMarSeen = true;
                        divMar.marSeen = true;
                    })
                    .fail((err)=>{
                        divMar.error='Ah ocurrido un error';
                        divMar.errMarSeen = true;
                        divMar.marSeen = true;
                    });
        });
        $("#btnObtenMarca").click(()=>{
            divMar.resMarSeen = false;
                divMar.errMarSeen = false;
                divMar.tabMarSeen = false;
                divMar.marSeen = true;
            $.get("/marcas")
                .done((res)=>{
                    console.log(res.marcas);
                    divMar.marcas = res.marcas;
                    divMar.tabMarSeen = true;
                })
                .fail((err)=>{
                        divCat.error='Ah ocurrido un error';
                        divCat.errCatSeen = true;
                    });
        });
        $("#btnBorraMarca").click(()=>{
            tablaCategorias.mostrar = false;
            divErrCat.seen = false;
            divResCat.seen = false;
            divResCatBorr.seen = false;
            let request = $.ajax({
            url: "/categorias",
            method: "DELETE",
            data: { nombre : nombre },
            dataType: "json"
            });
            console.log(request);
        });
        function loadPage(){
            console.log('asdasd');
            console.log(divCat);
            console.log(divMar);
        }
    </script>



    <!-- <script>
        $("#btnCreaCategoria").click(()=>{
            $("#divRespuestaCategoriaCreado").hide();
            $("#divErrorCategoriaCreado").hide();
            var data = $("#formCreaProducto").serialize();
            //Falta gestionar el error
            $.post("/categorias", data)
                .done((res)=>{
                    $("#nombre").html(res.categoria.nombre);
                    $("#descripcion").html(res.categoria.descripcion);
                    $("#divRespuestaCategoriaCreado").show();
                })
                .fail((res)=>{
                    alert(res);
                    console.log(res.error.msg);
                    $("#error").html("La ccategoria ya existe");
                    $("#divErrorCategoriaCreado").show();
                });

           /*  Vue.http.post("/categorias", data)
                .then((res)=>{
                    $("#nombre").html(res.categoria.nombre);
                    $("#descripcion").html(res.categoria.descripcion);
                    $("#divRespuestaCategoriaCreado").show();
                }),
                ((res)=>{
                    alert(res);
                    console.log(res.error.msg);
                    $("#error").html("La ccategoria ya existe");
                    $("#divErrorCategoriaCreado").show();
                }) */
        });
    </script>
 -->
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Tienda</title>
</head>
<body>
    <h1>CREA CATEGORIAS</h1>
    <form id="formCreaProducto">
        <fieldset>
            <div>
                <label>Nombre</label>
                <input type="text" name="nombre"/>
            </div>
            <div>
                <label>Descripcion</label>
                <input type="text" name="descripcion"/>
            </div>
            <div>
                <input id="btnCreaCategoria" type="button" value="Crear nueva categoria"/>
            </div>
        </fieldset>
    </form>
    <div id="divResCat">
            <fieldset v-if="seen">
              <legend>RESULTADO</legend>
              <h2>Categoria Creada</h2>
              <div>Nombre: {{nombre}}</div>
              <div>Descripcion: {{descripcion}} </div>
            </fieldset>
    </div>

    <h1>OBTIENE CATEGORIAS</h1>
    <button id="btnObtenCategoria">Obtener Categorias</button>
    <div id="tablaCategorias" v-if="mostrar">
        <ol>
            <li v-for="categoria in categorias">
                Categoria : {{categoria.nombre}}
            </li>
        </ol>
    </div>
    <div id="divErrCat">
        <fieldset v-if="seen">
          <legend>ERROR</legend>
          <div>Error:  {{error}}</div>
        </fieldset>
    </div>
    <script src="./js/jquery/jquery-3.3.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script>
        var respuestaPostCateg;
        var respuestaGetCateg;
        var divResCat = new Vue({
            el: '#divResCat',
            data:{
                seen: false,
                nombre: '',
                descripcion: ''
            }
        });
        var divErrCat = new Vue({
            el: '#divErrCat',
            data:{
                seen: false,
                error:''
            }
        });
        var tablaCategorias = new Vue({
            el: '#tablaCategorias',
            data:{
                mostrar: false,
                categorias:[]
            }
        });
        $("#btnCreaCategoria").click(()=>{
                divErrCat.seen = false;
                divResCat.seen = false;
                var data = $("#formCreaProducto").serialize();
                $.post("/categorias",data)
                    .done((res)=>{
                        divResCat.nombre= res.categoria.nombre;
                        divResCat.descripcion= res.categoria.descripcion;
                        divResCat.seen = true;
                    })
                    .fail((err)=>{
                        divErrCat.error='Ah ocurrido un error';
                        divErrCat.seen = true;
                    });
        });
        $("#btnObtenCategoria").click(()=>{
            tablaCategorias.mostrar = false;
            divErrCat.seen = false;
            divResCat.seen = false;
            $.get("/categorias")
                .done((res)=>{
                    console.log(res.categorias);
                    tablaCategorias.categorias = res.categorias;
                    tablaCategorias.mostrar=true;
                })
                .fail((err)=>{
                        divErrCat.error='Ah ocurrido un error';
                        divErrCat.seen = true;
                    });
        });
    </script>



    <!-- <script>
        $("#btnCreaCategoria").click(()=>{
            $("#divRespuestaCategoriaCreado").hide();
            $("#divErrorCategoriaCreado").hide();
            var data = $("#formCreaProducto").serialize();
            //Falta gestionar el error
            $.post("/categorias", data)
                .done((res)=>{
                    $("#nombre").html(res.categoria.nombre);
                    $("#descripcion").html(res.categoria.descripcion);
                    $("#divRespuestaCategoriaCreado").show();
                })
                .fail((res)=>{
                    alert(res);
                    console.log(res.error.msg);
                    $("#error").html("La ccategoria ya existe");
                    $("#divErrorCategoriaCreado").show();
                });

           /*  Vue.http.post("/categorias", data)
                .then((res)=>{
                    $("#nombre").html(res.categoria.nombre);
                    $("#descripcion").html(res.categoria.descripcion);
                    $("#divRespuestaCategoriaCreado").show();
                }),
                ((res)=>{
                    alert(res);
                    console.log(res.error.msg);
                    $("#error").html("La ccategoria ya existe");
                    $("#divErrorCategoriaCreado").show();
                }) */
        });
    </script>
 -->

</body>
</html>